<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColorBrand - Extractor de Paletas de Marca</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #fff;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
        }
        
        .card h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .upload-area {
            border: 3px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(74, 111, 165, 0.05);
        }
        
        .upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        #image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            display: none;
        }
        
        .palette-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .color-box {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        .color-box:hover {
            transform: translateY(-5px);
        }
        
        .color-value {
            font-size: 0.8rem;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 2px 5px;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        button.secondary {
            background-color: #6c757d;
        }
        
        button.secondary:hover {
            background-color: #545b62;
        }
        
        button.success {
            background-color: #28a745;
        }
        
        button.success:hover {
            background-color: #218838;
        }
        
        .applications {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .application-card {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .application-card:hover {
            transform: translateY(-5px);
        }
        
        .application-preview {
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
        }
        
        .application-info {
            padding: 15px;
            background-color: white;
        }
        
        .application-info h3 {
            margin-bottom: 8px;
            color: var(--secondary-color);
        }
        
        .contrast-checker {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #eee;
        }
        
        .contrast-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .contrast-text {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .contrast-result {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .pass {
            background-color: #d4edda;
            color: #155724;
        }
        
        .fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .code-block {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 4px solid var(--primary-color);
            display: none;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            border-radius: 0;
        }
        
        .tab-button.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.9rem;
        }
        
        .color-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .color-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .color-option input[type="radio"] {
            accent-color: var(--primary-color);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: none;
            z-index: 1000;
        }
        
        .color-count {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .color-count input {
            width: 60px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-palette"></i> ColorBrand</h1>
            <p>Extrae colores dominantes de tus productos o tienda y crea paletas de marca profesionales con aplicaciones prácticas</p>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="card">
                    <h2><i class="fas fa-upload"></i> Sube tu imagen</h2>
                    <div id="upload-area" class="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Arrastra y suelta una imagen de tu producto o tienda aquí</p>
                        <p>o haz clic para seleccionar un archivo</p>
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                    </div>
                    <img id="image-preview" alt="Vista previa de la imagen">
                    
                    <div class="color-count">
                        <label for="color-count">Número de colores a extraer:</label>
                        <input type="number" id="color-count" min="3" max="10" value="5">
                    </div>
                    
                    <div class="controls">
                        <button id="extract-btn"><i class="fas fa-magic"></i> Extraer colores</button>
                        <button id="reset-btn" class="secondary"><i class="fas fa-redo"></i> Reiniciar</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-swatchbook"></i> Paleta de colores</h2>
                    <p>Colores dominantes extraídos de tu imagen:</p>
                    <div id="palette-container" class="palette-container">
                        <!-- Los colores se generarán aquí -->
                    </div>
                    
                    <div class="color-options">
                        <div class="color-option">
                            <input type="radio" id="harmony-analogous" name="harmony" value="analogous" checked>
                            <label for="harmony-analogous">Análoga</label>
                        </div>
                        <div class="color-option">
                            <input type="radio" id="harmony-complementary" name="harmony" value="complementary">
                            <label for="harmony-complementary">Complementaria</label>
                        </div>
                        <div class="color-option">
                            <input type="radio" id="harmony-triadic" name="harmony" value="triadic">
                            <label for="harmony-triadic">Triádica</label>
                        </div>
                        <div class="color-option">
                            <input type="radio" id="harmony-monochromatic" name="harmony" value="monochromatic">
                            <label for="harmony-monochromatic">Monocromática</label>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button id="generate-harmony-btn"><i class="fas fa-random"></i> Generar combinaciones</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-universal-access"></i> Verificador de contraste accesible</h2>
                    <p>Prueba la legibilidad de combinaciones de texto y fondo según estándares WCAG:</p>
                    
                    <div class="contrast-checker">
                        <div class="contrast-box" id="contrast-box1" style="background-color: #333; color: #fff;">
                            <div class="contrast-text">Texto de ejemplo para prueba de contraste</div>
                            <div class="contrast-result pass" id="contrast-result1">Ratio: --</div>
                        </div>
                        
                        <div class="contrast-box" id="contrast-box2" style="background-color: #fff; color: #333;">
                            <div class="contrast-text">Texto de ejemplo para prueba de contraste</div>
                            <div class="contrast-result pass" id="contrast-result2">Ratio: --</div>
                        </div>
                        
                        <div class="controls">
                            <button id="check-contrast-btn"><i class="fas fa-eye"></i> Probar colores seleccionados</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="card">
                    <h2><i class="fas fa-paint-brush"></i> Aplicaciones de marca</h2>
                    <p>Sugerencias de uso para tu paleta de colores:</p>
                    
                    <div class="applications">
                        <div class="application-card">
                            <div class="application-preview" id="logo-preview" style="background-color: #f8f9fa;">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="application-info">
                                <h3>Logotipo</h3>
                                <p>Usa los colores primarios para crear un logotipo memorable.</p>
                            </div>
                        </div>
                        
                        <div class="application-card">
                            <div class="application-preview" id="walls-preview" style="background-color: #f8f9fa;">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="application-info">
                                <h3>Paredes y decoración</h3>
                                <p>Aplica colores secundarios en paredes de tienda u oficina.</p>
                            </div>
                        </div>
                        
                        <div class="application-card">
                            <div class="application-preview" id="uniforms-preview" style="background-color: #f8f9fa;">
                                <i class="fas fa-tshirt"></i>
                            </div>
                            <div class="application-info">
                                <h3>Uniformes</h3>
                                <p>Diseña uniformes con colores de acento para tu equipo.</p>
                            </div>
                        </div>
                        
                        <div class="application-card">
                            <div class="application-preview" id="packaging-preview" style="background-color: #f8f9fa;">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <div class="application-info">
                                <h3>Embalaje</h3>
                                <p>Usa la paleta en empaques de productos y materiales.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-file-export"></i> Exportar valores</h2>
                    <p>Exporta tu paleta de colores en diferentes formatos:</p>
                    
                    <div class="export-options">
                        <button id="export-hex-btn"><i class="fas fa-code"></i> Copiar HEX</button>
                        <button id="export-rgb-btn"><i class="fas fa-code"></i> Copiar RGB</button>
                        <button id="export-css-btn" class="success"><i class="fab fa-css3-alt"></i> Copiar CSS</button>
                        <button id="export-json-btn"><i class="fas fa-file-code"></i> Copiar JSON</button>
                    </div>
                    
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="hex">HEX</button>
                        <button class="tab-button" data-tab="rgb">RGB</button>
                        <button class="tab-button" data-tab="css">CSS</button>
                        <button class="tab-button" data-tab="json">JSON</button>
                    </div>
                    
                    <div id="hex-code" class="code-block"></div>
                    <div id="rgb-code" class="code-block"></div>
                    <div id="css-code" class="code-block"></div>
                    <div id="json-code" class="code-block"></div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-palette"></i> Paleta de combinaciones</h2>
                    <p>Combinaciones armónicas generadas a partir de tus colores:</p>
                    <div id="harmony-container" class="palette-container">
                        <!-- Las combinaciones se generarán aquí -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>ColorBrand &copy; 2023 - Herramienta para creación de paletas de marca</p>
            <p>Los colores se extraen directamente de tu imagen usando el algoritmo k-means clustering.</p>
        </footer>
    </div>
    
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i> <span id="notification-text">Copiado al portapapeles</span>
    </div>
    
    <script>
        // Variables globales
        let extractedColors = [];
        let harmonyColors = [];
        
        // Elementos DOM
        const uploadArea = document.getElementById('upload-area');
        const imageInput = document.getElementById('image-input');
        const imagePreview = document.getElementById('image-preview');
        const extractBtn = document.getElementById('extract-btn');
        const resetBtn = document.getElementById('reset-btn');
        const paletteContainer = document.getElementById('palette-container');
        const harmonyContainer = document.getElementById('harmony-container');
        const generateHarmonyBtn = document.getElementById('generate-harmony-btn');
        const checkContrastBtn = document.getElementById('check-contrast-btn');
        const exportHexBtn = document.getElementById('export-hex-btn');
        const exportRgbBtn = document.getElementById('export-rgb-btn');
        const exportCssBtn = document.getElementById('export-css-btn');
        const exportJsonBtn = document.getElementById('export-json-btn');
        const colorCountInput = document.getElementById('color-count');
        const tabButtons = document.querySelectorAll('.tab-button');
        const codeBlocks = document.querySelectorAll('.code-block');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        
        // Event Listeners
        uploadArea.addEventListener('click', () => imageInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary-color)';
            uploadArea.style.backgroundColor = 'rgba(74, 111, 165, 0.1)';
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.backgroundColor = '';
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.backgroundColor = '';
            
            if (e.dataTransfer.files.length) {
                imageInput.files = e.dataTransfer.files;
                loadImage();
            }
        });
        
        imageInput.addEventListener('change', loadImage);
        extractBtn.addEventListener('click', extractColors);
        resetBtn.addEventListener('click', resetApp);
        generateHarmonyBtn.addEventListener('click', generateHarmony);
        checkContrastBtn.addEventListener('click', checkContrast);
        exportHexBtn.addEventListener('click', () => exportColors('hex'));
        exportRgbBtn.addEventListener('click', () => exportColors('rgb'));
        exportCssBtn.addEventListener('click', () => exportColors('css'));
        exportJsonBtn.addEventListener('click', () => exportColors('json'));
        
        // Event listeners para pestañas
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.getAttribute('data-tab');
                
                // Activar pestaña seleccionada
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Mostrar bloque de código correspondiente
                codeBlocks.forEach(block => block.style.display = 'none');
                document.getElementById(`${tab}-code`).style.display = 'block';
            });
        });
        
        // Funciones
        
        // Cargar imagen y mostrar vista previa
        function loadImage() {
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                
                reader.readAsDataURL(imageInput.files[0]);
            }
        }
        
        // Extraer colores dominantes de la imagen
        function extractColors() {
            if (!imagePreview.src || imagePreview.src.includes('data:') === false) {
                showNotification('Por favor, sube una imagen primero', 'error');
                return;
            }
            
            const colorCount = parseInt(colorCountInput.value);
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0, img.width, img.height);
                
                // Reducir tamaño para procesamiento más rápido
                const scaledWidth = 100;
                const scaledHeight = 100;
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = scaledWidth;
                tempCanvas.height = scaledHeight;
                tempCtx.drawImage(canvas, 0, 0, scaledWidth, scaledHeight);
                
                const imageData = tempCtx.getImageData(0, 0, scaledWidth, scaledHeight).data;
                
                // Algoritmo simple para extraer colores más comunes (simulación de k-means)
                extractedColors = getDominantColors(imageData, colorCount);
                
                // Actualizar la paleta
                updatePalette();
                
                // Generar combinaciones armónicas automáticamente
                generateHarmony();
                
                // Actualizar aplicaciones
                updateApplications();
                
                showNotification(`Se extrajeron ${extractedColors.length} colores dominantes`, 'success');
            };
            
            img.src = imagePreview.src;
        }
        
        // Algoritmo simplificado para extraer colores dominantes
        function getDominantColors(imageData, colorCount) {
            const colors = [];
            const colorMap = {};
            
            // Muestra de píxeles para acelerar el proceso
            for (let i = 0; i < imageData.length; i += 16) { // Saltar píxeles
                const r = imageData[i];
                const g = imageData[i + 1];
                const b = imageData[i + 2];
                
                // Agrupar colores similares
                const key = `${Math.floor(r/32)*32},${Math.floor(g/32)*32},${Math.floor(b/32)*32}`;
                
                if (colorMap[key]) {
                    colorMap[key].count++;
                } else {
                    colorMap[key] = { r, g, b, count: 1 };
                }
            }
            
            // Ordenar por frecuencia y tomar los más comunes
            const sortedColors = Object.values(colorMap).sort((a, b) => b.count - a.count);
            
            // Tomar los N colores más comunes
            for (let i = 0; i < Math.min(colorCount, sortedColors.length); i++) {
                const color = sortedColors[i];
                const hex = rgbToHex(color.r, color.g, color.b);
                colors.push({
                    hex: hex,
                    rgb: `rgb(${color.r}, ${color.g}, ${color.b})`,
                    r: color.r,
                    g: color.g,
                    b: color.b
                });
            }
            
            return colors;
        }
        
        // Actualizar la visualización de la paleta
        function updatePalette() {
            paletteContainer.innerHTML = '';
            
            extractedColors.forEach(color => {
                const colorBox = document.createElement('div');
                colorBox.className = 'color-box';
                colorBox.style.backgroundColor = color.hex;
                colorBox.setAttribute('data-hex', color.hex);
                colorBox.setAttribute('data-rgb', color.rgb);
                
                colorBox.innerHTML = `
                    <div class="color-value">${color.hex}</div>
                `;
                
                // Copiar al hacer clic
                colorBox.addEventListener('click', () => {
                    copyToClipboard(color.hex);
                    showNotification(`Color ${color.hex} copiado al portapapeles`);
                });
                
                paletteContainer.appendChild(colorBox);
            });
            
            // Actualizar bloques de código de exportación
            updateExportCode();
        }
        
        // Generar combinaciones armónicas
        function generateHarmony() {
            if (extractedColors.length === 0) {
                showNotification('Extrae colores primero', 'error');
                return;
            }
            
            const harmonyType = document.querySelector('input[name="harmony"]:checked').value;
            harmonyContainer.innerHTML = '';
            harmonyColors = [];
            
            // Tomar el color principal (el primero de la lista)
            const baseColor = extractedColors[0];
            
            // Generar combinaciones según el tipo seleccionado
            switch(harmonyType) {
                case 'analogous':
                    harmonyColors = generateAnalogousColors(baseColor);
                    break;
                case 'complementary':
                    harmonyColors = generateComplementaryColors(baseColor);
                    break;
                case 'triadic':
                    harmonyColors = generateTriadicColors(baseColor);
                    break;
                case 'monochromatic':
                    harmonyColors = generateMonochromaticColors(baseColor);
                    break;
            }
            
            // Mostrar las combinaciones
            harmonyColors.forEach(color => {
                const colorBox = document.createElement('div');
                colorBox.className = 'color-box';
                colorBox.style.backgroundColor = color.hex;
                
                colorBox.innerHTML = `
                    <div class="color-value">${color.hex}</div>
                `;
                
                harmonyContainer.appendChild(colorBox);
            });
            
            showNotification(`Combinación ${harmonyType} generada`, 'success');
        }
        
        // Generar colores análogos
        function generateAnalogousColors(baseColor) {
            const colors = [];
            const hsv = rgbToHsv(baseColor.r, baseColor.g, baseColor.b);
            
            // Variar el matiz en -30, -15, 0, +15, +30 grados
            for (let i = -2; i <= 2; i++) {
                const newHue = (hsv.h + i * 15 + 360) % 360;
                const newRgb = hsvToRgb(newHue, hsv.s, hsv.v);
                colors.push({
                    hex: rgbToHex(newRgb.r, newRgb.g, newRgb.b),
                    rgb: `rgb(${newRgb.r}, ${newRgb.g}, ${newRgb.b})`
                });
            }
            
            return colors;
        }
        
        // Generar colores complementarios
        function generateComplementaryColors(baseColor) {
            const colors = [];
            const hsv = rgbToHsv(baseColor.r, baseColor.g, baseColor.b);
            
            // Color base
            colors.push({
                hex: baseColor.hex,
                rgb: baseColor.rgb
            });
            
            // Color complementario (opuesto en la rueda de color)
            const compHue = (hsv.h + 180) % 360;
            const compRgb = hsvToRgb(compHue, hsv.s, hsv.v);
            colors.push({
                hex: rgbToHex(compRgb.r, compRgb.g, compRgb.b),
                rgb: `rgb(${compRgb.r}, ${compRgb.g}, ${compRgb.b})`
            });
            
            // Variaciones de saturación y valor
            for (let i = 1; i <= 3; i++) {
                const newRgb = hsvToRgb(compHue, Math.max(0.2, hsv.s - i*0.2), Math.max(0.2, hsv.v - i*0.1));
                colors.push({
                    hex: rgbToHex(newRgb.r, newRgb.g, newRgb.b),
                    rgb: `rgb(${newRgb.r}, ${newRgb.g}, ${newRgb.b})`
                });
            }
            
            return colors;
        }
        
        // Generar colores triádicos
        function generateTriadicColors(baseColor) {
            const colors = [];
            const hsv = rgbToHsv(baseColor.r, baseColor.g, baseColor.b);
            
            // Colores triádicos (separados por 120 grados)
            for (let i = 0; i < 3; i++) {
                const newHue = (hsv.h + i * 120) % 360;
                const newRgb = hsvToRgb(newHue, hsv.s, hsv.v);
                colors.push({
                    hex: rgbToHex(newRgb.r, newRgb.g, newRgb.b),
                    rgb: `rgb(${newRgb.r}, ${newRgb.g}, ${newRgb.b})`
                });
            }
            
            return colors;
        }
        
        // Generar colores monocromáticos
        function generateMonochromaticColors(baseColor) {
            const colors = [];
            const hsv = rgbToHsv(baseColor.r, baseColor.g, baseColor.b);
            
            // Variar el valor (brillo) manteniendo el mismo matiz y saturación
            for (let i = 0; i < 5; i++) {
                const newValue = 0.2 + (i * 0.2);
                const newRgb = hsvToRgb(hsv.h, hsv.s, newValue);
                colors.push({
                    hex: rgbToHex(newRgb.r, newRgb.g, newRgb.b),
                    rgb: `rgb(${newRgb.r}, ${newRgb.g}, ${newRgb.b})`
                });
            }
            
            return colors;
        }
        
        // Verificar contraste entre colores
        function checkContrast() {
            if (extractedColors.length < 2) {
                showNotification('Necesitas al menos 2 colores para verificar contraste', 'error');
                return;
            }
            
            // Tomar los dos primeros colores
            const color1 = extractedColors[0];
            const color2 = extractedColors[1];
            
            // Calcular ratio de contraste
            const contrastRatio = getContrastRatio(
                [color1.r, color1.g, color1.b],
                [color2.r, color2.g, color2.b]
            );
            
            // Actualizar cajas de contraste
            const contrastBox1 = document.getElementById('contrast-box1');
            const contrastBox2 = document.getElementById('contrast-box2');
            const contrastResult1 = document.getElementById('contrast-result1');
            const contrastResult2 = document.getElementById('contrast-result2');
            
            // Configurar primera combinación (color1 fondo, color2 texto)
            contrastBox1.style.backgroundColor = color1.hex;
            contrastBox1.style.color = color2.hex;
            contrastResult1.textContent = `Ratio: ${contrastRatio.toFixed(2)}`;
            contrastResult1.className = `contrast-result ${contrastRatio >= 4.5 ? 'pass' : 'fail'}`;
            
            // Configurar segunda combinación (color2 fondo, color1 texto)
            contrastBox2.style.backgroundColor = color2.hex;
            contrastBox2.style.color = color1.hex;
            contrastResult2.textContent = `Ratio: ${contrastRatio.toFixed(2)}`;
            contrastResult2.className = `contrast-result ${contrastRatio >= 4.5 ? 'pass' : 'fail'}`;
            
            // Mostrar recomendación
            if (contrastRatio >= 7) {
                showNotification('Contraste excelente (WCAG AAA)', 'success');
            } else if (contrastRatio >= 4.5) {
                showNotification('Contraste bueno (WCAG AA)', 'success');
            } else {
                showNotification('Contraste insuficiente para texto normal', 'error');
            }
        }
        
        // Calcular ratio de contraste según WCAG
        function getContrastRatio(rgb1, rgb2) {
            const luminance1 = getRelativeLuminance(rgb1[0], rgb1[1], rgb1[2]);
            const luminance2 = getRelativeLuminance(rgb2[0], rgb2[1], rgb2[2]);
            
            const lighter = Math.max(luminance1, luminance2);
            const darker = Math.min(luminance1, luminance2);
            
            return (lighter + 0.05) / (darker + 0.05);
        }
        
        // Calcular luminancia relativa
        function getRelativeLuminance(r, g, b) {
            const sRGB = [r/255, g/255, b/255];
            
            const linearRGB = sRGB.map(c => {
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            
            return 0.2126 * linearRGB[0] + 0.7152 * linearRGB[1] + 0.0722 * linearRGB[2];
        }
        
        // Actualizar aplicaciones de marca con colores extraídos
        function updateApplications() {
            if (extractedColors.length === 0) return;
            
            // Actualizar logo con primer color
            document.getElementById('logo-preview').style.backgroundColor = extractedColors[0].hex;
            document.getElementById('logo-preview').style.color = getContrastColor(extractedColors[0].hex);
            
            // Actualizar paredes con segundo color (si existe)
            if (extractedColors.length > 1) {
                document.getElementById('walls-preview').style.backgroundColor = extractedColors[1].hex;
                document.getElementById('walls-preview').style.color = getContrastColor(extractedColors[1].hex);
            }
            
            // Actualizar uniformes con tercer color (si existe)
            if (extractedColors.length > 2) {
                document.getElementById('uniforms-preview').style.backgroundColor = extractedColors[2].hex;
                document.getElementById('uniforms-preview').style.color = getContrastColor(extractedColors[2].hex);
            }
            
            // Actualizar embalaje con cuarto color (si existe) o primero
            const packagingColor = extractedColors.length > 3 ? extractedColors[3] : extractedColors[0];
            document.getElementById('packaging-preview').style.backgroundColor = packagingColor.hex;
            document.getElementById('packaging-preview').style.color = getContrastColor(packagingColor.hex);
        }
        
        // Obtener color de contraste adecuado (blanco o negro)
        function getContrastColor(hexColor) {
            // Convertir HEX a RGB
            const r = parseInt(hexColor.substr(1, 2), 16);
            const g = parseInt(hexColor.substr(3, 2), 16);
            const b = parseInt(hexColor.substr(5, 2), 16);
            
            // Calcular luminosidad
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
        }
        
        // Exportar colores en diferentes formatos
        function exportColors(format) {
            if (extractedColors.length === 0) {
                showNotification('No hay colores para exportar', 'error');
                return;
            }
            
            let exportText = '';
            
            switch(format) {
                case 'hex':
                    exportText = extractedColors.map(color => color.hex).join('\n');
                    break;
                case 'rgb':
                    exportText = extractedColors.map(color => color.rgb).join('\n');
                    break;
                case 'css':
                    exportText = ':root {\n';
                    extractedColors.forEach((color, index) => {
                        exportText += `  --brand-color-${index + 1}: ${color.hex};\n`;
                        exportText += `  --brand-color-${index + 1}-rgb: ${color.rgb};\n`;
                    });
                    exportText += '}';
                    break;
                case 'json':
                    const colorsData = {
                        palette: extractedColors,
                        generated: new Date().toISOString(),
                        source: 'ColorBrand'
                    };
                    exportText = JSON.stringify(colorsData, null, 2);
                    break;
            }
            
            copyToClipboard(exportText);
            showNotification(`Paleta exportada en formato ${format.toUpperCase()}`, 'success');
        }
        
        // Actualizar bloques de código de exportación
        function updateExportCode() {
            if (extractedColors.length === 0) return;
            
            // HEX
            let hexCode = '';
            extractedColors.forEach(color => {
                hexCode += `${color.hex}\n`;
            });
            document.getElementById('hex-code').textContent = hexCode;
            
            // RGB
            let rgbCode = '';
            extractedColors.forEach(color => {
                rgbCode += `${color.rgb}\n`;
            });
            document.getElementById('rgb-code').textContent = rgbCode;
            
            // CSS
            let cssCode = ':root {\n';
            extractedColors.forEach((color, index) => {
                cssCode += `  --brand-color-${index + 1}: ${color.hex};\n`;
                cssCode += `  --brand-color-${index + 1}-rgb: ${color.rgb};\n`;
            });
            cssCode += '}';
            document.getElementById('css-code').textContent = cssCode;
            
            // JSON
            const colorsData = {
                palette: extractedColors,
                generated: new Date().toISOString(),
                source: 'ColorBrand'
            };
            document.getElementById('json-code').textContent = JSON.stringify(colorsData, null, 2);
            
            // Mostrar la primera pestaña por defecto
            document.getElementById('hex-code').style.display = 'block';
        }
        
        // Reiniciar aplicación
        function resetApp() {
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            imageInput.value = '';
            extractedColors = [];
            harmonyColors = [];
            paletteContainer.innerHTML = '';
            harmonyContainer.innerHTML = '';
            
            // Resetear aplicaciones
            const applications = document.querySelectorAll('.application-preview');
            applications.forEach(app => {
                app.style.backgroundColor = '#f8f9fa';
                app.style.color = '#333';
            });
            
            // Resetear verificador de contraste
            const contrastBox1 = document.getElementById('contrast-box1');
            const contrastBox2 = document.getElementById('contrast-box2');
            const contrastResult1 = document.getElementById('contrast-result1');
            const contrastResult2 = document.getElementById('contrast-result2');
            
            contrastBox1.style.backgroundColor = '#333';
            contrastBox1.style.color = '#fff';
            contrastResult1.textContent = 'Ratio: --';
            contrastResult1.className = 'contrast-result pass';
            
            contrastBox2.style.backgroundColor = '#fff';
            contrastBox2.style.color = '#333';
            contrastResult2.textContent = 'Ratio: --';
            contrastResult2.className = 'contrast-result pass';
            
            // Resetear bloques de código
            codeBlocks.forEach(block => block.textContent = '');
            
            showNotification('Aplicación reiniciada', 'success');
        }
        
        // Mostrar notificación
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            
            if (type === 'error') {
                notification.style.backgroundColor = '#dc3545';
            } else if (type === 'success') {
                notification.style.backgroundColor = '#28a745';
            } else {
                notification.style.backgroundColor = 'var(--primary-color)';
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Copiar texto al portapapeles
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Éxito, la notificación se muestra desde la función llamadora
            }).catch(err => {
                console.error('Error al copiar: ', err);
                showNotification('Error al copiar al portapapeles', 'error');
            });
        }
        
        // Funciones de utilidad para conversión de colores
        
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        
        function rgbToHsv(r, g, b) {
            r /= 255, g /= 255, b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, v = max;
            
            const d = max - min;
            s = max === 0 ? 0 : d / max;
            
            if (max === min) {
                h = 0; // achromatic
            } else {
                switch(max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            return {
                h: Math.round(h * 360),
                s: parseFloat(s.toFixed(2)),
                v: parseFloat(v.toFixed(2))
            };
        }
        
        function hsvToRgb(h, s, v) {
            h = h % 360;
            s = s / 100 || 0;
            v = v / 100 || 0;
            
            let r, g, b;
            const i = Math.floor(h / 60);
            const f = h / 60 - i;
            const p = v * (1 - s);
            const q = v * (1 - f * s);
            const t = v * (1 - (1 - f) * s);
            
            switch(i % 6) {
                case 0: r = v, g = t, b = p; break;
                case 1: r = q, g = v, b = p; break;
                case 2: r = p, g = v, b = t; break;
                case 3: r = p, g = q, b = v; break;
                case 4: r = t, g = p, b = v; break;
                case 5: r = v, g = p, b = q; break;
            }
            
            return {
                r: Math.round(r * 255),
                g: Math.round(g * 255),
                b: Math.round(b * 255)
            };
        }
        
        // Inicializar aplicación con algunos colores de ejemplo
        window.addEventListener('DOMContentLoaded', () => {
            // Cargar una imagen de ejemplo
            const exampleImage = new Image();
            exampleImage.onload = function() {
                // Crear un canvas para obtener los colores de ejemplo
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = exampleImage.width;
                canvas.height = exampleImage.height;
                ctx.drawImage(exampleImage, 0, 0);
                
                // Colores de ejemplo (simulados para la demo)
                extractedColors = [
                    {hex: "#4a6fa5", rgb: "rgb(74, 111, 165)", r: 74, g: 111, b: 165},
                    {hex: "#166088", rgb: "rgb(22, 96, 136)", r: 22, g: 96, b: 136},
                    {hex: "#95b8d1", rgb: "rgb(149, 184, 209)", r: 149, g: 184, b: 209},
                    {hex: "#edddd4", rgb: "rgb(237, 221, 212)", r: 237, g: 221, b: 212},
                    {hex: "#772e25", rgb: "rgb(119, 46, 37)", r: 119, g: 46, b: 37}
                ];
                
                updatePalette();
                generateHarmony();
                updateApplications();
            };
            
            // Usar un gradiente como imagen de ejemplo
            exampleImage.src = 'data:image/svg+xml;base64,' + btoa(`
                <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a6fa5;stop-opacity:1" />
                            <stop offset="25%" style="stop-color:#166088;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#95b8d1;stop-opacity:1" />
                            <stop offset="75%" style="stop-color:#edddd4;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#772e25;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="400" height="300" fill="url(#grad1)"/>
                </svg>
            `);
            
            // Mostrar imagen de ejemplo en el preview
            imagePreview.src = exampleImage.src;
            imagePreview.style.display = 'block';
            
            // Mostrar primera pestaña
            document.getElementById('hex-code').style.display = 'block';
        });
    </script>
</body>
</html>